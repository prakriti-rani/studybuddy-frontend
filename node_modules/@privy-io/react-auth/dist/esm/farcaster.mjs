import{useCallback as t}from"react";import{P as e,f as i,u as s}from"./internal-context-mSHyF0Gq.mjs";import{a6 as a,a7 as n}from"./paths-Q47X90aK.mjs";import"ofetch";class r{async init(){if(!this.api)throw new e("Auth flow has no API instance");let{nonce:t}=await this.api.post(a,{});return{nonce:t}}async authenticate(){if(!this.message||!this.signature||!this.fid)throw new e("Auth flow has no message, signature, or fid");if(!this.api)throw new e("Auth flow has no API instance");try{let t=await this.api.post(n,{message:this.message,signature:this.signature,fid:this.fid});if(!t)throw new e("No response from authentication");return t}catch(t){throw i(t)}}async link(){throw Error("Not implemented")}setAuthData({message:t,signature:e,fid:i}){this.message=t,this.signature=e,this.fid=i}constructor(){this.meta={}}}const o=()=>{let{client:i,setAuthenticated:a,setUser:n}=s();return{initLoginToFrame:t((async()=>{let t=new r;if(!i)throw new e("Must initialize Privy client first.");return i.startAuthFlow(t),await t.init()}),[i]),loginToFrame:t((async({message:t,signature:s})=>{if(!i)throw new e("Must initialize Privy client first.");if(!(i.authFlow instanceof r))throw new e("Must initialize Farcaster frame flow first.");let o=(t=>{let e=t.match(/farcaster:\/\/fid\/(\d+)/);return e&&e[1]?parseInt(e[1],10):null})(t);if(!o)throw new e("Invalid message format; could not parse Farcaster ID.");i.authFlow.setAuthData({message:t,signature:s,fid:o});let{user:h}=await i.authenticate();return h&&(n(h),a(!0)),h}),[i,n,a])}};export{o as useLoginToFrame};
